var TodoApp;(function(t){var o=function(){function o(){this.layoutView=new t.LayoutView,this.view().controller=this,this.view().on("keyup","#new-todo",this.addNewTodo)}return o.prototype.view=function(){return this.layoutView},o.prototype.addNewTodo=function(o,e){var n=this.view().newTodo.val();if(13==e.which&&""!=n){var i=new t.Todo(n);t.Todos.push(i),this.view().newTodo.val(""),Core.mediator.publish("UpdateTodos")}},o}();t.Layout=o})(TodoApp||(TodoApp={}));var TodoApp;(function(t){var o=function(){function o(){this.todoListView=new t.TodoListView,Core.mediator.subscribe(this,"UpdateTodos",this.updateTodoList);var o=this.view();o.controller=this,o.on("click","input.toggle",this.toggleStatus),o.on("dblclick","label",this.edit),o.on("keyup",".edit",this.finishEditOnEnter),o.on("blur",".edit",this.finishEdit)}return o.prototype.view=function(){return this.todoListView},o.prototype.updateTodoList=function(){this.view().render()},o.prototype.toggleStatus=function(o){var e=this.view().toggleIndexOf(o);t.Todos[e].toggle()},o.prototype.edit=function(t){var o=this.view().labelIndexOf(t);this.view().childAt(o).element().addClass("editing")},o.prototype.finishEditOnEnter=function(t,o){13==o.which&&this.finishEdit(t,o)},o.prototype.finishEdit=function(o){var e=this.view().editIndexOf(o),n=this.view().childAt(e);n.element().removeClass("editing");var i=n.editElement().val();i&&(t.Todos[e].updateTitle(i),n.render())},o}();t.TodoController=o})(TodoApp||(TodoApp={}));var Core;(function(t){var o=function(){function t(){this.subscribers=[]}return t.prototype.subscribe=function(t,o,e){this.subscribers.push({context:t,event:o,callback:e})},t.prototype.unsubscribe=function(t){var o=this.subscribers;this.filterTargets({key:"context",value:t}).forEach(function(t){var e=o.indexOf(t);e>=0&&o.splice(e,1)})},t.prototype.publish=function(t){this.filterTargets({key:"event",value:t}).forEach(function(t){t.callback.call(t.context,arguments)})},t.prototype.filterTargets=function(t){return this.subscribers.filter(function(o){return o[t.key]==t.value})},t}();t.Mediator=o,t.mediator=new o})(Core||(Core={}));var Core;(function(){(function(){function t(){}return t})()})(Core||(Core={}));var Core;(function(t){var o=function(t,o){return function(e){o.call(t,this,e)}},e=function(){function t(){this.controller=null}return t.prototype.element=function(){return null},t.prototype.render=function(){},t.prototype.on=function(t,e,n){$(document.body).on(t,e,o(this.controller,n))},t}();t.BindableView=e})(Core||(Core={})),$(function(){new TodoApp.Layout,new TodoApp.TodoController});var TodoApp;(function(t){var o=function(){function t(t){this.title="untitled",this.completed=!1,this.title=t}return t.prototype.toggle=function(){this.completed=!this.completed},t.prototype.updateTitle=function(t){this.title=t},t.prototype.attributes=function(){return{title:this.title,completed:this.completed}},t}();t.Todo=o,t.Todos=[]})(TodoApp||(TodoApp={}));var __extends=this.__extends||function(t,o){function e(){this.constructor=t}e.prototype=o.prototype,t.prototype=new e},TodoApp;(function(t){var o=function(t){function o(){t.apply(this,arguments),this.newTodo=$("#new-todo")}return __extends(o,t),o.prototype.element=function(){return $("#body")},o.prototype.render=function(){},o}(Core.BindableView);t.LayoutView=o})(TodoApp||(TodoApp={}));var __extends=this.__extends||function(t,o){function e(){this.constructor=t}e.prototype=o.prototype,t.prototype=new e},TodoApp;(function(t){var o=function(o){function n(){o.apply(this,arguments),this.todos=t.Todos,this.children=[]}return __extends(n,o),n.prototype.element=function(){return $("#todo-list")},n.prototype.render=function(){var t=this,o=this.element(),n=this.todos;o.html(""),this.children=[];for(var i=0,r=n.length;r>i;i++)(function(){var n=new e;n.todoIndex=i,n.render(),o.append(n.element()),t.children.push(n)})()},n.prototype.childAt=function(t){return this.children[t]},n.prototype.toggleIndexOf=function(t){return this.indexOf(t,"#todo-list li input.toggle")},n.prototype.labelIndexOf=function(t){return this.indexOf(t,"#todo-list li div label")},n.prototype.editIndexOf=function(t){return this.indexOf(t,"#todo-list li input.edit")},n.prototype.indexOf=function(t,o){return $(o).index($(t))},n}(Core.BindableView);t.TodoListView=o;var e=function(){function o(){this.todoIndex=null,this.editing=!1,this.todoElement=$("<li></li>")}return o.prototype.element=function(){return this.todoElement},o.prototype.editElement=function(){return this.todoElement.find("input.edit")},o.prototype.render=function(){var o=t.Todos[this.todoIndex];this.todoElement.html("");var e=Template.Todo(o.attributes(),this.editing);this.todoElement.append($(e))},o}();t.TodoView=e})(TodoApp||(TodoApp={}));var Template;(function(t){t.Todo=function(t,o){var e=t.completed?"checked":"",o=o?'class="editing"':"",n=t.title,i="";return i+='<div class="view" '+o+">",i+='  <input class="toggle" type="checkbox" '+e+">",i+="  <label>"+n+"</label>",i+='  <button class="destroy"></button>',i+="</div>",i+='<input class="edit" value="'+n+'">'}})(Template||(Template={}));